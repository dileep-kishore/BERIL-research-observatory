---
reviewer: BERIL Automated Review
date: 2026-02-16
project: enigma_contamination_functional_potential
---

# Review: Contamination Gradient vs Functional Potential in ENIGMA Communities

## Summary
This is a clear, well-structured project with a reproducible three-notebook workflow, complete saved outputs, and appropriately cautious interpretation of mostly null associations. The strict-vs-relaxed mapping sensitivity design is a strong methodological addition and the report aligns with observed model outputs. The main weaknesses are analytical rather than operational: the final modeling does not implement the depth/site controls stated in the hypothesis, broad genus-level COG proxies reduce sensitivity, and unmapped taxa handling is not explicitly quantified in model diagnostics.

## Methodology
The research question is explicit and testable in `README.md` and `RESEARCH_PLAN.md`, and data sources are concretely identified (ENIGMA `ddt_brick*` + `sdt_*`, and `kbase_ke_pangenome` tables). Notebook responsibilities match the plan (extraction/QC, taxonomy bridge/features, modeling), and reproducibility is generally strong: `requirements.txt` exists, all three notebooks are executed with saved outputs, and expected data/figure artifacts are present.

One important mismatch remains: H0 in `RESEARCH_PLAN.md` is phrased as "after controlling for sampling depth and site structure," but `notebooks/03_contamination_functional_models.ipynb` (Cell 4) applies univariate Spearman/OLS against contamination index only, without depth/site covariates. The README reproduction section is otherwise good and clearly separates Spark-required vs downstream-local steps, but it does not report expected runtime ranges.

## Code Quality
Notebook organization follows a sensible sequence (setup -> extraction/feature build -> modeling/figures). The implementation follows key BERDL pitfall guidance from `docs/pitfalls.md`: Spark is used for heavy joins/aggregation (`01_enigma_extraction_qc.ipynb`, Cells 4-5), SQL numeric casting is explicit for string-like numeric fields (Cell 3 and Cell 4), and annotation joins use the documented key (`gene_cluster.gene_cluster_id` to `eggnog_mapper_annotations.query_name` in `02_taxonomy_bridge_functional_features.ipynb`, Cell 6).

`03_contamination_functional_models.ipynb` correctly guards low-information outcomes (e.g., `constant_feature`) rather than forcing invalid tests. A key analytical risk is visible in Cell 4: taxa that fail bridge/feature mapping are effectively assigned zero functional signal via `fillna(0.0)`, which can induce contamination-dependent attenuation if mapped fractions vary by sample. This is not necessarily a coding bug, but it should be treated as a modeled assumption and diagnosed explicitly.

No direct runtime or syntax bugs were observed in the reviewed code paths.

## Findings Assessment
`REPORT.md` conclusions are supported by `data/model_results.tsv`: weak/non-significant stress and defense associations in both mapping modes, null metabolism signal, and mobilome flagged as `constant_feature`. The report appropriately avoids over-claiming and states that H1 is not supported at current resolution.

Limitations are acknowledged (taxonomic resolution, mapping coverage, coarse proxies, limited covariate adjustment), and listed figures are present in `figures/`. Interpretation is cautious and consistent with the displayed evidence.

## Suggestions
1. [Critical] Align model implementation with the stated hypothesis by adding depth/site-adjusted analyses in `notebooks/03_contamination_functional_models.ipynb` (e.g., include `depth_meter` and location/site effects from `sample_location_metadata.tsv`).
2. [Critical] Redefine mobilome/stress features so `site_mobilome_score` has non-zero variance; the current constant feature blocks inference and weakens the stress composite.
3. [High] Quantify and report per-sample mapped vs unmapped abundance fractions, then test whether results are robust when conditioning on mapping coverage (or restricting to high-coverage samples).
4. [Medium] Add expected runtime guidance to `README.md` Reproduction (rough ranges for NB01-03) so reruns can be planned without trial-and-error.
5. [Medium] Increase notebook narrative detail (currently minimal markdown context) so analytical decisions and assumptions are easier to audit directly in notebook form.

## Review Metadata
- **Reviewer**: BERIL Automated Review
- **Date**: 2026-02-16
- **Scope**: README.md, 3 notebooks, 7 data files, 3 figures
- **Note**: This review was generated by an AI system. It should be treated as advisory input, not a definitive assessment.
